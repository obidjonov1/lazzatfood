<%- include('includes/header') %>

<link rel="stylesheet" href="/css/menu.css" />

<body>
  <div id="main_container">
    <div class="group_name">
      <ul class="nav justify-content-center">
        <li class="nav-item" style="cursor: pointer">
          <a class="nav-link active" href="/resto">Home</a>
        </li>
        <li class="nav-item" style="cursor: pointer">
          <a class="nav-link" href="/resto/all-market">AllResto</a>
        </li>
        <li class="nav-item" style="cursor: pointer">
          <a class="nav-link" href="/resto/logout">Logout</a>
        </li>
      </ul>
    </div>

    <div class="restaurant_menu_frame">
      <div class="restaurant_container">
        <div class="resto_table">
          <span class="new_dish_txt">List of All Markets</span>
          <table class="table table-hover table-sm">
            <thead class="thead-light">
              <tr class="thead-light" style="text-align: center">
                <th scope="col">T/r</th>
                <th scope="col">Market name</th>
                <th scope="col">Market phone</th>
                <th scope="col">TOP Market</th>
                <th scope="col">Market Status</th>
              </tr>
            </thead>

            <% markets_data.map(function(value, key) { %>
            <tbody style="background: white; text-align: center">
              <td><%= key +1 %></td>
              <td style="text-transform: uppercase"><%= value.mb_nick %></td>
              <td><%= value.mb_phone %></td>
              <td style="width: 13%">
                <label class="switch">
                  <input type="checkbox" class="mb_top" id="<%= value._id %>"
                  <%= value.mb_top === "Y" ? 'checked' : "" %> />
                  <span class="slider raund"></span>
                </label>
              </td>
              <td style="width: 13%">
                <select class="spec_select mb_status" id="<%= value._id %>">
                  <option value="ONPAUSE" <%= value.mb_status === 'ONPAUSE' ?
                  'selected' : '' %> >ONPAUSE <option value="ACTIVE" <%=
                  value.mb_status === 'ACTIVE' ? 'selected' : '' %>>ACTIVE
                  <option value="DELETED" <%= value.mb_status === 'DELETED' ?
                  'selected' : '' %>>DELETED
                </select>
              </td>
            </tbody>
            <% }); %>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    // document get ready
    $(function () {
      // monupulate markets top features
      $(".mb_top").on("change", function (e) {
        // marketlarni .id sini olinyapti ->
        const id = e.target.id;
        const mb_top = e.target.checked ? "Y" : "N";
        // update bo'lgan datani bodyga yuklanyapti ->
        axios
          .post("/resto/all-market/edit", { id: id, mb_top: mb_top })
          .then((response) => {
            //response.data ni ichida marketController[164] (res.jsonga path qilganimiz) beriladi
            const result = response.data;
            if (result.state === "success") alert("successfully updated");
            else alert(result.message);
          })
          .catch((err) => console.log(err));
      });

      /*  monupulate markets STATUS features */
      $(".mb_status").on("change", function (e) {
        // marketlarni .id sini olinyapti ->
        const id = e.target.id;
        const mb_status = $(`#${id}.mb_status`).val();

        // update bo'lgan datani bodyga yuklanyapti ->
        axios
          .post("/resto/all-market/edit", { id: id, mb_status: mb_status })
          .then((response) => {
            //response.data ni ichida marketController[164] (res.jsonga path qilganimiz) beriladi
            const result = response.data;
            if (result.state === "success") alert("successfully updated");
            else alert(result.message);
          })
          .catch((err) => console.log(err));
      });
    });
  </script>
</body>

<%- include('includes/footer') %>
